# Анализ и описание архитектурных опций и обоснование выбора

## 1. Общая архитектурная модель

Микросервисная архитектура – основа для масштабируемости, гибкости и устойчивости системы. Каждая бизнес-функция или группа функций реализуется как отдельный сервис (например, управление группами, профилями, рекомендациями, потоками активности, интеграцией устройств).

Обоснование:
- Позволяет независимо развивать и масштабировать компоненты.
- Упрощает внедрение новых возможностей или обновлений без влияния на всю систему.
- Легче обеспечивать высокую доступность и надежность.

---

## 2. Облачная инфраструктура

Использование гибридного или мультиоблачного подхода для оптимизации затрат, отказоустойчивости и соответствия требованиям безопасности.

- Облачные провайдеры: СберCloud, МТСCloud или иные облачные провайдеры на рынке РФ или целевой провайдер  компании
- Базы данных: 
    - NoSQL для хранения профилей, сообщений, активности.
    - SQL базы (PostgreSQL) для транзакционных данных и аналитики.
  - Масштабируемые серверы приложений / контейнеры (Kubernetes) для микросервисов.

Обоснование:
- Высокая доступность, масштабируемость и гибкость.
- Возможность выбирать оптимальные сервисы под конкретные задачи.
- Гибкое управление ресурсами.

---

### 3. Компоненты архитектуры и их обоснование

#### 3.1. Модуль управления пользователями и аутентификация 
- Экземпляры API, обеспечивающие регистрацию, аутентификацию (OAuth2, OpenID Connect), управление профилями, настройками приватности.
- Интеграция с системами ID входов. Например, ТинькоффID, VKID и др.
#### 3.2. Сервисы
Все сервисы реализованы как микросервисы с отельными БД. Для асинхронного обмена брокер сообщений Kafka.
Для кластеризации можно использовать Patroni.
Все сервисы установлены на мониторинг, можно использовать Grafana + Prometheus.
Для отслеживания и визуализации бизнес метрик можно использовать ежедневную репликацию необходимых данных и FineBI для постороения дашбордов и мониторинга метрик.

#### 3.3. Поиск и рекомендации
- Использование Elasticsearch или OpenSearch для поиска по интересам, маршрутам, регионам.

#### 3.4. Интеграция сторонних устройств
- Использование стандартных API Bluetooth, BLE, протоколов, API платформ производителей датчиков.
- Централизованный агент или API шлюз для сбора данных с устройств.

---

### 4. Особенности реализации

#### 4.1. Обеспечение безопасности и приватности
- Использование OAuth 2.0 и JWT для авторизации/аутентификации.
- Управление правами доступа с учетом региональных требований (GDPR, CCPA).

#### 4.2. Мульти-гео поддержка и локализация
- Гео-сервисы для определения региона пользователя и предоставления локальных промоакций.
- Локализация интерфейса.
- Динамическая настройка контента в зависимости от места нахождения.

#### 4.3. Поддержка больших событий
- Архитектура, способная масштабироваться для проведения соревнований с большим числом участников.
- Использование CDN для доставки контента.
- Реалтаймовые системы (WebSocket) для синхронного взаимодействия в соревнованиях.

---

### Итоги выбора архитектуры

| Критерий | Выбор | Обоснование |
|------------|--------------|-----------------------------
| Масштабируемость | Микросервисы + облачные платформы | Позволяет адаптироваться к росту числа пользователей и данных |
| Гибкость интеграции | API-driven, сторонние интеграции | Легко подключать сторонние устройства, сервисы и платформы |
| Надежность | Мультиоблачные решения, репликация данных, горизонтальное масштабирование | Высокая доступность и отказоустойчивость |
| Безопасность | Шифрование, управление доступом, региональные регламенты | Защита данных, соответствие правовым требованиям |
| Пользовательский опыт | Оптимизация поиска, рекомендации, локализация | Увлеченность и вовлеченность пользователей |

---

### Итоговая рекомендация

Создать модульную, масштабируемую микросервисную архитектуру с использованием облачных решений в зависимости от региональных требований и стоимости. В качестве базовых технологий — контейнеризация (Kubernetes/EKS), NoSQL базы для активностей и профилей, POSIX-compliant базы данных для транзакционных данных, системы поиска и рекомендаций для персонализации, а также API шлюзы для интеграции сторонних устройств и остальных систем компании.

Это обеспечит надежную, расширяемую платформу, которая сможет удовлетворить все поставленные требования и обеспечить развитие продукта в долгосрочной перспективе.

